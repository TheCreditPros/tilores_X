#!/bin/bash

# Pre-push hook to validate deployment readiness
echo "ğŸš€ Running pre-push deployment checks..."

# Check for required deployment files
echo "ğŸ“‹ Checking deployment configuration..."
if [ ! -f "railway.json" ]; then
    echo "âŒ railway.json is missing!"
    exit 1
fi

if [ ! -f "nixpacks.toml" ]; then
    echo "âŒ nixpacks.toml is missing!"
    exit 1
fi

if [ ! -f "Procfile" ]; then
    echo "âŒ Procfile is missing!"
    exit 1
fi

if [ ! -f "requirements.txt" ]; then
    echo "âŒ requirements.txt is missing!"
    exit 1
fi

# Activate virtual environment if it exists
if [ -f "venv/bin/activate" ]; then
    source venv/bin/activate
fi

# Validate JSON syntax
echo "ğŸ” Validating railway.json..."
python3 -c "import json; json.load(open('railway.json'))" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "âŒ railway.json has invalid JSON syntax!"
    exit 1
fi

# Quick Python syntax check on main files
echo "ğŸ Checking Python syntax..."
python3 -m py_compile main_enhanced.py 2>/dev/null
if [ $? -ne 0 ]; then
    echo "âŒ main_enhanced.py has syntax errors!"
    exit 1
fi

python3 -m py_compile core_app.py 2>/dev/null
if [ $? -ne 0 ]; then
    echo "âŒ core_app.py has syntax errors!"
    exit 1
fi

echo "âœ… All pre-push checks passed!"
echo "ğŸ“¦ Pushing to GitHub will trigger Railway deployment..."
echo "ğŸ” Check deployment status at: https://railway.com/project/09db04c8-03ac-4661-b2fd-b631d7209c3d"
